# Launcher å¿«é€Ÿå¼€å§‹æŒ‡å—

## éªŒè¯å®‰è£…

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ launcher æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```bash
# æµ‹è¯• launcher å¯åŠ¨ï¼ˆ5ç§’åè‡ªåŠ¨åœæ­¢ï¼‰
timeout 5s npm run launcher
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸš€ Launcher å¯åŠ¨ä¸­...
ğŸ“ å·¥ä½œç›®å½•: /data00/home/caifeng.nice/myclaw/my_claw
ğŸ“„ çŠ¶æ€æ–‡ä»¶: .restart-state.json
ğŸ“¤ æ­£åœ¨å¯åŠ¨å­è¿›ç¨‹...
âœ… å­è¿›ç¨‹å·²å°±ç»ª
ğŸš€ cf_claw server starting on port 3000...
âœ… é£ä¹¦Agentæ¡¥æ¥æœåŠ¡å¯åŠ¨æˆåŠŸ
```

## æ­£å¸¸ä½¿ç”¨

### 1. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨ launcher å¯åŠ¨
npm run launcher

# æˆ–åå°è¿è¡Œ
nohup npm run launcher > launcher.log 2>&1 &
```

### 2. é‡å¯æœåŠ¡

åœ¨é£ä¹¦å¯¹è¯ä¸­å‘é€ï¼š
```
/restart
```

æœºå™¨äººå°†è‡ªåŠ¨ï¼š
1. å›å¤ç¡®è®¤æ¶ˆæ¯
2. é‡å¯æœåŠ¡
3. å‘é€é‡å¯ç»“æœé€šçŸ¥

### 3. åœæ­¢æœåŠ¡

```bash
# å¦‚æœåœ¨å‰å°è¿è¡Œï¼ŒæŒ‰ Ctrl+C
# å¦‚æœåœ¨åå°è¿è¡Œï¼Œæ‰¾åˆ°è¿›ç¨‹å¹¶æ€æ­»
ps aux | grep launcher
kill <PID>
```

## æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

1. æ£€æŸ¥æ—¥å¿—ï¼š
```bash
npm run launcher 2>&1 | tee launcher.log
```

2. æ£€æŸ¥æ˜¯å¦æœ‰é—ç•™çš„çŠ¶æ€æ–‡ä»¶ï¼š
```bash
cat .restart-state.json 2>/dev/null || echo "æ— çŠ¶æ€æ–‡ä»¶"
```

3. æ£€æŸ¥ git stash åˆ—è¡¨ï¼š
```bash
git stash list
```

### IPC é€šä¿¡å¤±è´¥

å¦‚æœçœ‹åˆ° "ä¸åœ¨ IPC æ¨¡å¼" çš„è­¦å‘Šï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºç›´æ¥ä½¿ç”¨ `npm run start` è€Œä¸æ˜¯ `npm run launcher` å¯åŠ¨çš„ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œåªæœ‰ launcher fork çš„å­è¿›ç¨‹æ‰æœ‰ IPC é€šé“ã€‚

### ç«¯å£è¢«å ç”¨

å¦‚æœçœ‹åˆ°ç«¯å£è¢«å ç”¨çš„é”™è¯¯ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ 3000 ç«¯å£çš„è¿›ç¨‹
lsof -i :3000

# æ€æ­»è¿›ç¨‹
kill <PID>
```

## æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”¨æˆ·                        â”‚
â”‚               ï¼ˆé£ä¹¦å¯¹è¯ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ å‘é€ /restart
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           launcher.ts                       â”‚
â”‚           ï¼ˆçˆ¶è¿›ç¨‹ï¼‰                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. fork å­è¿›ç¨‹                        â”‚  â”‚
â”‚  â”‚ 2. ç­‰å¾… ready ä¿¡å·                   â”‚  â”‚
â”‚  â”‚ 3. ç›‘æ§å­è¿›ç¨‹é€€å‡º                     â”‚  â”‚
â”‚  â”‚ 4. å¤±è´¥æ—¶æ‰§è¡Œå›æ»š (git stash)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ fork / IPC é€šä¿¡
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           src/index.ts                      â”‚
â”‚           ï¼ˆå­è¿›ç¨‹/ä¸šåŠ¡æœåŠ¡ï¼‰                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. å¯åŠ¨ HTTP æœåŠ¡                   â”‚  â”‚
â”‚  â”‚ 2. è¿æ¥é£ä¹¦ WebSocket              â”‚  â”‚
â”‚  â”‚ 3. å‘é€ ready ä¿¡å·ç»™ launcher      â”‚  â”‚
â”‚  â”‚ 4. å¤„ç† /restart æŒ‡ä»¤              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `launcher.ts` | çˆ¶è¿›ç¨‹ç®¡ç†å™¨ï¼Œè´Ÿè´£ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç† |
| `src/index.ts` | ä¸šåŠ¡æœåŠ¡å…¥å£ï¼Œå¤„ç† HTTP å’Œé£ä¹¦æœåŠ¡ |
| `src/services/feishu/feishu-agent-bridge.ts` | é£ä¹¦æœåŠ¡æ¡¥æ¥ï¼Œå¤„ç†æ¶ˆæ¯å’Œ /restart æŒ‡ä»¤ |
| `.restart-state.json` | é‡å¯çŠ¶æ€æ–‡ä»¶ï¼Œç”¨äºè·¨è¿›ç¨‹é€šä¿¡ |

## ä¸‹ä¸€æ­¥

1. **é…ç½®ç¯å¢ƒå˜é‡**: ç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…è¦çš„é…ç½®
2. **æµ‹è¯• /restart æŒ‡ä»¤**: åœ¨é£ä¹¦å¯¹è¯ä¸­å‘é€ `/restart` æµ‹è¯•é‡å¯åŠŸèƒ½
3. **æ¨¡æ‹Ÿå¯åŠ¨å¤±è´¥**: æ•…æ„å¼•å…¥è¯­æ³•é”™è¯¯ï¼Œæµ‹è¯•å›æ»šåŠŸèƒ½
4. **éƒ¨ç½²åˆ°ç”Ÿäº§**: ä½¿ç”¨ `nohup` æˆ– `pm2` åœ¨åå°è¿è¡Œ
